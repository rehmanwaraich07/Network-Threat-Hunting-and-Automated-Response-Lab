# Detect potential C2 beaconing (repetitive connections)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Possible C2 Beacon - Repetitive Connection"; \
  flow:established,to_server; threshold:type both, track by_src, count 10, seconds 60; \
  classtype:trojan-activity; sid:1000001; rev:1;)

# Detect suspicious User-Agent strings
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"Suspicious User-Agent - PowerShell"; \
  flow:established,to_server; content:"User-Agent|3a 20|"; http_header; \
  content:"PowerShell"; http_header; nocase; \
  classtype:trojan-activity; sid:1000002; rev:1;)

# Detect Metasploit User-Agent
alert http any any -> $HOME_NET any (msg:"Metasploit User-Agent Detected"; \
  flow:established,to_server; content:"User-Agent|3a|"; http_header; \
  content:"Metasploit"; http_header; nocase; \
  classtype:trojan-activity; sid:1000003; rev:1;)

# Detect large data exfiltration
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"Large Data Transfer - Possible Exfiltration"; \
  flow:established,to_server; threshold:type threshold, track by_src, count 1, seconds 60; \
  byte_test:4,>,10000000,0,relative; \
  classtype:policy-violation; sid:1000004; rev:1;)

# Detect DNS tunneling (long subdomain queries)
alert dns $HOME_NET any -> any 53 (msg:"Possible DNS Tunneling - Long Subdomain"; \
  dns_query; content:"."; isdataat:50,relative; \
  classtype:policy-violation; sid:1000005; rev:1;)